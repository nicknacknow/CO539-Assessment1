<!DOCTYPE html>
<html>
    <head>
        <title>Assessment1</title>
        <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/ui/1.14.0/jquery-ui.min.js" integrity="sha256-Fb0zP4jE3JHqu+IBB9YktLcSjI1Zc6J2b6gTjB0LpoM=" crossorigin="anonymous"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

        <script>
            $(() => {
                const REGIONS_URL = "https://www.cs.kent.ac.uk/people/staff/yh/api/country-data/countries/regions"; // Endpoint for regions
                const REGION_DATA_URL = "https://www.cs.kent.ac.uk/people/staff/yh/api/country-data/countries/region/"; // needs to be appended for specific region

                // given an array of names, this method will generate radio buttons for each name and append it to the parent element.
                function CreateRadioButtons(button_names, section_name, parent, callback) {
                    button_names.forEach(button_name => {
                        let out = $('<div class="m-2"/>'); // create new div element for checkbox
                        let radio = $(`<input class="form-check-input m-1" type="radio" name="${section_name}" id="${button_name}"/>`);
                        radio.click(callback);
                        
                        radio.appendTo(out);
                        //out.append(`<input class="form-check-input m-1" type="radio" name="${section_name}" id="${button_name}"/>`); // create checkbox input with id of 'region'
                        out.append(`<label class="form-check-label" for="${button_name}">${button_name}</label>`); // create label for checkbox with id 'region'

                        // if callback is not null, adds click event to radio button.
                        if (callback) {
                            $(radio).unbind("click"); // prevents click callback from calling multiple times
                            $(radio).click(callback);
                        }

                        out.appendTo(parent); // append our new checkbox div element to the #regions element
                    })
                }

                // TASK 1:  this function appends a checkbox for each region into its designated area.
                function LoadRegions(regions) {
                    regions = regions.filter(i => i !== "Antarctic"); // remove antarctic entry sorry

                    CreateRadioButtons(regions, "region", $("#regions"), onSelectRegion);
                }

                // TASK 2:  once a region button has been selected, this will be called
                function onSelectRegion(data) {                    
                    // clear previous board-sizes
                    let parent = $("#board-sizes");
                    parent.empty(); // empty previous radio buttons
                    parent.parent().css("visibility", "visible"); // make container visible
                    
                    // create radio buttons
                    CreateRadioButtons(["4 x 2", "4 x 4"], "board-size", parent, onBoardSelection);
                }

                // TASK 3

                function getRandomValueFromArray(arr) {
                    return arr[Math.floor(Math.random() * arr.length)];
                }

                async function getRandomCountriesByRegion(reg, len) {
                    let countries = [];

                    await $.getJSON(REGION_DATA_URL + reg, (data) => {
                        while (countries.length < len) {
                            let country = getRandomValueFromArray(data);
                            if (!countries.includes(country)) { // prevent conflicts
                                countries.push(country);
                            }
                        }
                    });

                    return countries;
                }

                function separateCountryData(countries) {
                    let separate_country_data = [];

                    countries.forEach(country => {
                        let name = country.name; // work on this
                    });

                    return separate_country_data;
                }

                async function onBoardSelection(e) {
                    // load board container#

                    // populate board:
                    // - get selected region
                    let selectedRegion = $('input[name="region"]:checked')[0].id;
                    console.log(selectedRegion);

                    // - calculate number of countries needed
                    let numCountries = (e.target.id == "4 x 4") ? 16 : 8;
                    console.log(numCountries);

                    // - select number of countries
                    //      this function should need await & async but it works without ? just gonna use it to be safe
                    let countries = await getRandomCountriesByRegion(selectedRegion, numCountries); 
                    console.log(countries);

                    // - for each country, load flag and name separately into list
                    separateCountryData(countries);
                    // - 'scramble' list (make them random)
                    // - draw them onto html - make similar function to CreateRadioButtons?

                    // number of matches text element, updated by cards on html
                    // button to show answers

                    // task 4 may require multiple callbacks passed thru as a list
                    // for hover, click etc ? idk maybe not 
                }


                // Load Regions from API
                $.getJSON(REGIONS_URL, LoadRegions);

                /*
                Good resources:
                Lect2.html
                Weather Demo


                https://getbootstrap.com/docs/4.0/utilities/spacing/
                https://getbootstrap.com/docs/5.3/utilities/flex/
                */
            });

        </script>
    </head>
    <body class="p-5 text-center">
        <h1>Match countries with their flags</h1>
        <h3 class="pt-4 pb-2">Select a region:</h3>

        <div id="regions" class="d-flex justify-content-center">
            <!-- loaded in jQuery @ Line 25-->
        </div>
        

        <div id="board-container" style="visibility: hidden;">
            <h3 class="pt-5 pb-2">Choose the board size:</h3>
            <div id="board-sizes" class="d-flex flex-row justify-content-center">
                <!-- loaded in jQuery @ Line 32-->
            </div>
        </div>

        <div id="game-container" class="pt-3">
            <div class="container">
                <div class="row row-cols-5"> <!-- cols-5 since each child has a margin that needs to be accounted for -->
                    <div class="col border border-2 border-secondary rounded pb-5 bg-light m-3">
                        <p class="fs-5 m-1">Slovenia</p>
                        <p class="fs-6">Capital: ldbjbbugj</p>
                    </div>
                    <div class="col border border-2 border-secondary rounded pb-5 bg-light m-3">
                        <p class="fs-5 m-1">Slovenia</p>
                        <p class="fs-6">Capital: ldbjbbugj</p>
                    </div>
                    <div class="col border border-2 border-secondary rounded pb-5 bg-light m-3">
                        <p class="fs-5 m-1">Slovenia</p>
                        <p class="fs-6">Capital: ldbjbbugj</p>
                    </div>
                    <div class="col border border-2 border-secondary rounded pb-5 bg-light m-3">
                        <p class="fs-5 m-1">Slovenia</p>
                        <p class="fs-6">Capital: ldbjbbugj</p>
                    </div>

                    <div class="col border border-2 border-secondary rounded pb-5 bg-light m-3">
                        <p class="fs-5 m-1">Slovenia</p>
                        <p class="fs-6">Capital: ldbjbbugj</p>
                    </div>
                    <div class="col border border-2 border-secondary rounded pb-5 bg-light m-3">
                        <p class="fs-5 m-1">Slovenia</p>
                        <p class="fs-6">Capital: ldbjbbugj</p>
                    </div>
                    <div class="col border border-2 border-secondary rounded pb-5 bg-light m-3">
                        <p class="fs-5 m-1">Slovenia</p>
                        <p class="fs-6">Capital: ldbjbbugj</p>
                    </div>
                    <div class="col border border-2 border-secondary rounded pb-5 bg-light m-3">
                        <p class="fs-5 m-1">Slovenia</p>
                        <p class="fs-6">Capital: ldbjbbugj</p>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>